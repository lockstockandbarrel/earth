

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="description" content="Fortran date and time manipulation and presentation">
    <meta name="author" content="John S. Urban" >
    <link rel="icon" href="./favicon.png">

    <title> M_time </title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <!-- Font Awesome -->
    <link href="./css/fontawesome.min.css" rel="stylesheet">
    <link href="./css/brands.min.css" rel="stylesheet">
    <link href="./css/regular.min.css" rel="stylesheet">
    <link href="./css/solid.min.css" rel="stylesheet">
    <link href="./css/v4-font-face.min.css" rel="stylesheet">
    <link href="./css/v4-shims.min.css" rel="stylesheet">
    <!-- MathJax -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { equationNumbers: { autoNumber: "AMS" } }
      });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async
            integrity="sha256-DViIOMYdwlM/axqoGDPeUyf0urLoHMN4QACBKyB58Uw=" crossorigin="anonymous"></script>
    <!-- Other scripts and stylesheets -->
    <link href="./css/local.css" rel="stylesheet">
    <link href="./css/pygments.css" rel="stylesheet">
    <script src="./js/svg-pan-zoom.min.js"></script>
  </head>

  <body>

    <!-- Fixed navbar -->
    <div class="container-fluid mb-sm-4 mb-xl-2">
      <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container">
          <a class="navbar-brand" href="./index.html">M_time </a>
          <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar"
                  aria-expanded="false" aria-controls="navbar" aria-label="Toggle navigation">
                  <span class="navbar-toggler-icon">
          </button>

          <div id="navbar" class="navbar-collapse collapse">
            <ul class="navbar-nav">
                  <li class="nav-item">
                    <a class="nav-link" href="./lists/files.html">Source Files</a>
                  </li>
                <li class="nav-item">
                  <a class="nav-link" href="./lists/modules.html">Modules</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="./lists/procedures.html">Procedures</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="./lists/programs.html">Programs</a>
                </li>
            </ul>
              <div class="d-flex align-items-end flex-grow-1">
                <form action="./search.html" role="search" class="ms-auto">
                  <input type="text" class="form-control" aria-label="Search" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
                </form>
              </div>
          </div><!--/.nav-collapse -->
        </div>
      </nav>
    </div>

    <div class="container">
  <!-- Main component for a primary marketing message or call to action -->
    <div class="p-5 mb-4 bg-light border rounded-3" id="jumbotron">
      <p>Fortran date and time manipulation and presentation</p>
        <p> Find us on&hellip;</p>
      <p>
        <a class="btn btn-lg btn-primary" href="https://github.com/urbanjost/M_time" role="button">GitHub</a>
        
        
        
        
        <a class="btn btn-lg btn-danger" style="float:right" href="https://github.com/urbanjost/M_time/archive/refs/heads/master.zip" role="button">Download the Source</a>
      </p>
    </div>

      <div class="row" id='text'>
        <div class=col-md-8>
          <h1>M_time</h1>
          <!--
author_pic:
twitter:
website:
-->
<h1 id="m_utf8">M_utf8</h1>
<h2 id="a-wip-work-in-progress">A WIP (Work In Progress)</h2>
<p>Fortran does not inherently provide a direct built-in function to
convert an arbitrary UTF-8 encoded string to UCS-4 (ISO_10646) character
kind. While Fortran 2003 and later standards introduce support for
different character kinds, including ISO_10646 (UCS-4), the conversion
from a byte-stream representing UTF-8 to the UCS-4 character kind typically
requires manual decoding accept when reading and writing from a file with
encoding set to &ldquo;UTF-8&rdquo;.</p>
<p>Herein are some experiments in helping to facilitate using source codes
containing UTF-8 encoded strings as standard Fortran Unicode characters
instead of as ASCII byte streams that contain UTF-8 constant strings, such
as the procedures</p>
<ul>
<li>utf8_to_codepoints</li>
<li>utf8_to_ucs4</li>
<li>utf8_to_ucs4_via_io</li>
<li>ucs4_to_utf8</li>
</ul>
<p>Fortran supports just using 4-byte UCS-4 encoding for characters/glyphs quite
well, including an option to automatically encode and decode data read and written
to UTF-8 files. Where the issues start is that the standard specifies default 
character kinds for the OPEN FILE= specifier, filenames on INQUIRE, strings returned
by GET_COMMAND_ARGUMENT, &hellip; . So you can not just forget about ASCII quite yet.
And some systems might use other encodings like UTF-16, so basically Fortran still
needs procedures or methods for converting between UCS-4, UTF-16, UTF-8, and possibly
other encodings before you can just use Unicode everywhere in Fortran and forget about
ASCII or other encodings. Plus there apparently is currently a dearth of documentation 
about using Unicode from Fortran. This material is meant to fill in the gap with both
issues.</p>
<p>The intent is for the information to useful for all Fortran processing, but currently
is primarily tested with gfortran on Linux and Cygwin.</p>
<div class="codehilite"><pre><span></span><code><span class="k">program </span><span class="n">testit</span><span class="w"></span>
<span class="k">use </span><span class="n">iso_fortran_env</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">stdout</span><span class="o">=&gt;</span><span class="n">output_unit</span><span class="w"></span>
<span class="k">use </span><span class="n">M_utf8</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">utf8_to_ucs4</span><span class="w"></span>
<span class="k">implicit none</span>
<span class="kt">integer</span><span class="p">,</span><span class="k">parameter</span><span class="w">                       </span><span class="kd">::</span><span class="w"> </span><span class="n">ucs4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">selected_char_kind</span><span class="p">(</span><span class="s2">&quot;ISO_10646&quot;</span><span class="p">)</span><span class="w"></span>
<span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="p">:,</span><span class="nb">kind</span><span class="o">=</span><span class="n">ucs4</span><span class="p">),</span><span class="k">allocatable</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">str</span><span class="w"></span>

<span class="w">   </span><span class="k">open</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">)</span><span class="w"></span>

<span class="w">   </span><span class="c">! standard method</span>
<span class="w">   </span><span class="n">str</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">ucs4_</span><span class="s1">&#39;Hello World and Ni Hao -- &#39;</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">      </span><span class="o">//</span><span class="w"> </span><span class="nb">char</span><span class="w"> </span><span class="p">(</span><span class="nb">int</span><span class="w"> </span><span class="p">(</span><span class="n">z</span><span class="s1">&#39;4F60&#39;</span><span class="p">),</span><span class="w"> </span><span class="n">ucs4</span><span class="p">)</span><span class="w">         </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">      </span><span class="o">//</span><span class="w"> </span><span class="nb">char</span><span class="w"> </span><span class="p">(</span><span class="nb">int</span><span class="w"> </span><span class="p">(</span><span class="n">z</span><span class="s1">&#39;597D&#39;</span><span class="p">),</span><span class="w"> </span><span class="n">ucs4</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">str</span><span class="w"></span>

<span class="w">   </span><span class="c">! converting pseudo-utf8 to ucs4</span>
<span class="w">   </span><span class="n">str</span><span class="o">=</span><span class="w"> </span><span class="n">utf8_to_ucs4</span><span class="p">(</span><span class="s1">&#39;Hello World and Ni Hao -- 你好&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">str</span><span class="w"></span>
<span class="w">   </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">str</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">str</span><span class="p">(</span><span class="mi">27</span><span class="p">:</span><span class="mi">27</span><span class="p">)</span><span class="w"></span>

<span class="k">end program </span><span class="n">testit</span><span class="w"></span>
</code></pre></div>

<hr>
<h2 id="fortran-unicode-tutorial">Fortran Unicode Tutorial</h2>
<p>Here are some lessons that describe my experiences with Unicode and
Fortran, including discussions of open questions concerning what is
standardized, what extensions commonly used compilers provide to address
some of the current gaps, and what is known to be non-portable but useful
behavior from some compilers regarding undefined behaviors.</p>
<p><strong>WIP Notice:</strong> this has barely been begin. I am still sorting out what is and is
not standard.</p>
<p>Once constructed and stable, the lessons will become a tutorial on the Fortran Wiki,
and this project will contain the related modules and examples, but at this point
this is just an incomplete outline so starting the Wiki entries would be premature.</p>
<h3 id="introduction-to-fortran-unicode-support">Introduction to Fortran Unicode support</h3>
<ul>
<li><a href="docs/lesson1_ucs4.md"><strong>Lesson I:</strong></a> reading and writing UTF-8 Unicode files</li>
<li><a href="docs/lesson2_ucs4.md"><strong>Lesson II:</strong></a> creating Unicode strings in ASCII Fortran source files</li>
<li><a href="docs/lesson3_ucs4.md"><strong>Lesson III:</strong></a> mixing ASCII and UCS4 kinds as regards assignments,
                 concatenation, passing arguments to external ASCII libraries, and I/O argument lists</li>
<li><a href="docs/lesson4_ucs4.md"><strong>Lesson IV:</strong></a>what is and is not supported with internal READ and WRITE statements</li>
<li><a href="docs/lesson5_ucs.md"><strong>Lesson V:</strong></a>processing Unicode file names on OPEN() statements</li>
<li><a href="docs/lesson6_ucs4.md"><strong>Lesson VI:</strong></a> reading UTF-8 strings from command lines</li>
<li>Lesson VII:  passing Unicode strings to and from C</li>
<li>Lesson VIII: related utility programs</li>
</ul>
<h3 id="off-the-beaten-path">off the beaten path:</h3>
<ul>
<li>Lesson I: UTF-8 source files &ndash; just in comments and constants</li>
<li>Lesson II: the backslash escape code extension</li>
<li>Lesson III: converting between UCS-4 and UTF-8 with procedures</li>
<li>Lesson IV: embedding BOM characters at the beginning of files</li>
</ul>
<h3 id="processing-unicode-when-iso-10646-is-not-supported-by-a-compiler">Processing Unicode when ISO-10646 is not supported by a compiler</h3>
<ul>
<li>Lesson I: converting UTF-8 codes to and from INTEGER values</li>
<li>Lesson II: byte-oriented printing of 4-byte integers</li>
<li>Lesson III: issues with terminal emulators, system locale settings, and
                  other Unicode-related issues</li>
<li>Lesson IV: working with ASCII extended encodings; particularly those
                 commonly referred to as Extended, Latin, Latin1 and Latin2.</li>
</ul>
<hr>
<h2 id="dusty-corners">Dusty Corners</h2>
<p>Assigns between different character kinds, and an apparent
lack of an ability to specify encoding=&rsquo;UTF-8&rsquo; when using
internal reads and writes like you can with an OPEN(3f)
statement are still a little murky; as well as how the T
field descriptor works with multi-byte characters.</p>
<p>Note that at least with the gfortran(1) compiler conversion
to UCS4 internal representation works automatically when
reading and writing from files with encoding=&rsquo;utf-8&rsquo; specified,
this is just primarily concerned with UTF-8 string constants occurring
in the code files themselves.</p>
<h2 id="backslash-extension">backslash extension</h2>
<p>The gfortran(1) compiler supports an extension that allows for building
ucs4 strings more easily than using BOZ literals.</p>
<p>The following example prints the Unicode symbol ☻ (black smiling face)
of code point U+263B. The compiled binary must be executed in a terminal
with Unicode support, like XTerm or sakura.</p>
<div class="codehilite"><pre><span></span><code><span class="k">program </span><span class="n">main</span><span class="w"> </span><span class="c">! code to place in unicode.f90</span>
<span class="w">    </span><span class="k">use</span><span class="p">,</span><span class="w"> </span><span class="k">intrinsic</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">iso_fortran_env</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="p">:</span><span class="w"> </span><span class="n">output_unit</span><span class="w"></span>
<span class="w">    </span><span class="k">implicit none</span>
<span class="k">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ucs4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">selected_char_kind</span><span class="p">(</span><span class="s1">&#39;ISO_10646&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">ucs4</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="w"> </span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">str</span><span class="w"></span>

<span class="w">    </span><span class="c">! GFORTRAN EXTENSION:</span>
<span class="w">    </span><span class="n">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ucs4_</span><span class="s1">&#39;Unicode character: \u263B&#39;</span><span class="w"></span>

<span class="w">    </span><span class="k">open</span><span class="w"> </span><span class="p">(</span><span class="n">output_unit</span><span class="p">,</span><span class="w"> </span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">print</span><span class="w"> </span><span class="s1">&#39;(a)&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">str</span><span class="w"></span>
<span class="k">end program </span><span class="n">main</span><span class="w"></span>
</code></pre></div>

<p>Build and run the executable with:</p>
<div class="codehilite"><pre><span></span><code>$ gfortran -fbackslash -o unicode unicode.f90
$ ./unicode
Unicode character: ☻
</code></pre></div>

<p>The -fbackslash compiler flag is required for escaped Unicode
characters. Otherwise, the type conversion has to be done manually using
BOZ literals, for instance:</p>
<div class="codehilite"><pre><span></span><code>str = ucs4_&#39;Unicode character: &#39; // char(int(z&#39;263B&#39;), kind=ucs4)
</code></pre></div>

<p>Or, simply by using the decimal value of the character code point, without BOZ literal:</p>
<div class="codehilite"><pre><span></span><code>str = ucs4_&#39;Unicode character: &#39; // char(9787, kind=ucs2)
</code></pre></div>

<h2 id="see-also">See Also</h2>
<ul>
<li><a href="https://fortran-lang.discourse.group/t/how-to-use-utf-8-in-gfortran/9949">https://fortran-lang.discourse.group/t/how-to-use-utf-8-in-gfortran/9949</a></li>
<li><a href="https://fortran-lang.discourse.group/t/how-do-i-file-read-french-special-characters-like-e-etc/6618">https://fortran-lang.discourse.group/t/how-do-i-file-read-french-special-characters-like-e-etc/6618</a></li>
<li><a href="https://fortran-lang.discourse.group/t/using-unicode-characters-in-fortran/2764">https://fortran-lang.discourse.group/t/using-unicode-characters-in-fortran/2764</a></li>
</ul>
<!--
 + [UTF-8 Everywhere Manifesto](http://utf8everywhere.org/)
-->

<p>Other languages, such as the Python encode() and decode() procedures, supply related functionality.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># extract discourse as text</span>
lynx --dump https://fortran-lang.discourse.group/t/how-to-use-utf-8-in-gfortran/9949
lynx --dump https://fortran-lang.discourse.group/t/using-unicode-characters-in-fortran/2764
</code></pre></div>

<hr>
        </div>
          <div class="col-md-4">
            <div class="card card-body bg-light">
              <h2 class="card-title">Developer Info</h2>
              <h4 class="card-text">John S. Urban</h4>
              <p class="card-text"></p>
                <div class="text-center"><div class="btn-group" role="group">
                    
                    <a class="btn btn-lg btn-primary" href="https://github.com/urbanjost/M_time"><i class="fa fa-github fa-lg"></i></a>
                    
                    
                    
                    
                    
                    
                </div></div>
            </div>
          </div>
      </div>
        <div class="row">
          <hr>
          <div class="col-xs-6 col-sm-4">
            <div>
              <h3>Source Files</h3>
              <ul><li><a href='sourcefile/ascii_and_ucs4.f90.html'>ascii_and_ucs4.f90</a></li><li><a href='sourcefile/asciiset.f90.html'>asciiset.f90</a></li><li><a href='sourcefile/boz.f90.html'>boz.f90</a></li><li><a href='sourcefile/check.f90.html'>check.f90</a></li><li><a href='sourcefile/codepoints.f90.html'>codepoints.f90</a></li><li><a href='sourcefile/count_glyphs.f90.html'>count_glyphs.f90</a></li><li><a href='sourcefile/count_glyphs.f90~2.html'>count_glyphs.f90</a></li><li><a href='sourcefile/euro.f90.html'>euro.f90</a></li><li><a href='sourcefile/hello.f90.html'>hello.f90</a></li><li><a href='sourcefile/internal_io.f90.html'>internal_io.f90</a></li></ul>
            </div>
            <div>
              <ul>
                <li><a href="./lists/files.html"><em>All source files&hellip;</em></a></li>
              </ul>
            </div>
          </div>
          <div class="col-xs-6 col-sm-4">
            <div>
              <h3>Modules</h3>
              <ul><li><a href='module/m_utf8.html'>M_utf8</a></li><li><a href='module/odessa_unicode.html'>odessa_unicode</a></li></ul>
            </div>
            <div>
              <ul>
                <li><a href="./lists/modules.html"><em>All modules&hellip;</em></a></li>
              </ul>
            </div>
          </div>
          <div class="col-xs-6 col-sm-4">
            <div>
              <h3>Procedures</h3>
              <ul><li><a href='proc/checkit.html'>checkit</a></li><li><a href='proc/codepoints_to_utf8.html'>codepoints_to_utf8</a></li><li><a href='proc/create_date_string.html'>create_date_string</a></li><li><a href='proc/getargs.html'>getargs</a></li><li><a href='proc/isolatin_to_unicode.html'>isolatin_to_unicode</a></li><li><a href='proc/isolatin_to_utf32.html'>isolatin_to_utf32</a></li><li><a href='proc/isolatin_to_utf8.html'>isolatin_to_utf8</a></li><li><a href='proc/ucs4_to_utf8.html'>ucs4_to_utf8</a></li><li><a href='proc/ucs4_to_utf8~2.html'>ucs4_to_utf8</a></li><li><a href='proc/ucs4_to_utf8~3.html'>ucs4_to_utf8</a></li></ul>
            </div>
            <div>
              <ul>
                <li><a href="./lists/procedures.html"><em>All procedures&hellip;</em></a></li>
              </ul>
            </div>
          </div>
        </div>
      <hr>
    </div> <!-- /container -->
    <footer>
      <div class="container">
        <div class="row justify-content-between">
          <div class="col">
            <p>
              M_time
 was developed by John S. Urban<br>              &copy; 2025 
</p>
          </div>
          <div class="col">
            <p class="text-end">
              Documentation generated by
              <a href="https://github.com/Fortran-FOSS-Programmers/ford">FORD</a>
 on 2025-08-12 05:21 +0000             </p>
          </div>
        </div>
        <br>
      </div> <!-- /container -->
    </footer>
  </body>
</html>